fml.define("common/ptpParams",[],function(i,e){"use strict";window.PTP_PARAMS={EnableLogMoGuJs:!1,uuid:"__mgjuuid",uid:"__ud_",platform:function(){var i=navigator.userAgent;return i.indexOf("meilishuo4android")!=-1||i.indexOf("meilishuo android")!=-1?"24":i.indexOf("meilishuo4ios")!=-1||i.indexOf("Meilishuo iPhone")!=-1?"23":/iphone|android|ipad/i.test(i)?"34":"33"},hrefRe:/http[s]?:\/\/\w+\.(meilishuo|mogujie)\.com([\/]|\/.*|)$/,mgjRe:/(meilishuo|mls):\/\//,isNativeRe:/(meilishuo|mls|mogujie)/i,nativeLog:{}}});;fml.define("common/biu",[],function(o,t){"use strict";var n=function(){function o(){n.css("height",$(document).height()+"px")}function t(o){var t={url:location.href,refer:document.referrer,keyword:o};logger.log("000815009",t)}var n=$(".biu-sidebar"),u=$(".biu-download"),e=$(".mls-qrcode");o(),$(window).resize(function(){o()}),u.hover(function(){e.css("display","block")},function(){e.css("display","none")}),$(window).scroll(function(){document.body.scrollTop?document.body.scrollTop>0?$(".biu-go2top").css("display","block"):$(".biu-go2top").css("display","none"):document.documentElement.scrollTop&&document.documentElement.scrollTop>0?$(".biu-go2top").css("display","block"):$(".biu-go2top").css("display","none")}),$(".biu-go2top").on("click",function(){window.scrollTo(0,0)}),$(".biu-cart").on("click",function(){var o="购物车";t(o)}),$(".biu-coupon").on("click",function(){var o="优惠券";t(o)}),$(".biu-mark").on("click",function(){var o="收藏";t(o)}),$(".biu-footprint").on("click",function(){var o="足迹";t(o)}),$.ajax({type:"get",url:"http://cart.meilishuo.com/api/cart/getItemCount?marketType=market_meilishuo",dataType:"jsonp",success:function(o){var t=o||{};1001==t.status.code&&t.result&&t.result.count>0&&(t.result.count>99?$(".biu-cart-num").text("99+"):$(".biu-cart-num").text(t.result.count))},error:function(){console.log("--右侧栏 jsonp请求购物车商品数出错")}}),$.ajax({type:"get",url:"http://promotionnew.meilishuo.com/jsonp/getUnUsedCouponNumber/1?domain=11",dataType:"jsonp",success:function(o){var t=o||{};t.success&&t.data.number>0&&(t.data.number>99?$(".biu-coupon-num").text("99+"):$(".biu-coupon-num").text(t.data.number))},error:function(){console.log("--右侧栏 jsonp请求优惠券数出错")}}),$.ajax({type:"get",url:"http://webim.meilishuo.com/jsonp/cinfo/1",dataType:"jsonp",success:function(o){var t=o||{};t.success&&t.data.number>0&&$(".biu-service-num").text(t.data.number)},error:function(o,t){console.log("--右侧栏 jsonp请求客服消息数出错")}}),$(".biu-open-im").on("click",function(){var o=$(".biu-login").text(),n="消息";return t(n),""==o||"0"==o||null==o&&void 0!=o||" "==o?(window.open("https://account.meilishuo.com/user/login"),!1):(window._openIm(o,""),!1)})};n.prototype.biuAddCart=function(o){$.ajax({type:"get",url:"http://cart.meilishuo.com/api/cart/getItemCount?marketType=market_meilishuo",dataType:"jsonp",jsonp:"biuCartNum",success:function(t){var n=t||{};if(1001==n.status.code&&n.result&&n.result.count>0){var u=n.result.count+o;u>0&&u<100?$(".biu-cart-num").text(u):$(".biu-cart-num").text("99+")}}})};var u=new n;t.biuAddCart=u.biuAddCart});;fml.define("common/nav",[],function(t,i){"use strict";var a=$(".sec_attr .list");$(".nav_list");a.hover(function(){var t=$(this).children(".nav_list");0!=t.length&&(a.removeClass("active"),$(this).addClass("active"),t.show())},function(){a.removeClass("active"),$(this).removeClass("active"),$(this).children(".nav_list").hide()});var e=a.length;a.each(function(t){t==e-1&&$(this).addClass("last")});var n=$(".attr_box");"welcome"==Meilishuo.config.controller?n.css("display","block"):$(".all , .attr_box").hover(function(){n.stop(!0,!0).slideDown()},function(t){t.stopPropagation(),n.find(".nav_list").hide(),n.stop(!0,!0).slideUp()});var s={"/welcome":"首页","/brand/street":"品牌街","/officialDirect":"官网直邮","/select":"好物"},o="",l=location.pathname;$.each(s,function(t,i){if(0==l.indexOf(t))return o=s[t],!1}),"/"==l&&(o="首页");var c=$(".nav_tab");c.each(function(){var t=$(this).find("a").html();o==t&&$(this).find("a").addClass("active")})});;fml.define("common/search",[],function(t,e){"use strict";function a(t){t=t.list;for(var e="",a=0;a<t.length;a++){var o=t[a];e+='<a target="_blank" href="http://www.meilishuo.com/search/goods/?page=1&searchKey='+encodeURIComponent(o.word)+'" style="color:'+o.color+'">'+o.word+"</a >"}u.html(e)}function o(t){t&&t.list&&t.list.length&&(t=t.list[0],h.attr({placeholder:t.placehold,"data-placeholder":t.placehold,"data-key":t.word}))}function n(){$.ajax({url:"http://mce.meilishuo.com/jsonp/multiget/3?pids=5604,5571",dataType:"jsonp"}).then(function(t){t.success&&(a(t.data[5571]),o(t.data[5604]))})}function i(t){var e=/(?:&|\?)searchKey=([^&]+)/.exec(location.search);e&&e[1]&&h.val(decodeURI(e[1]));var a=/(?:&|\?)filter=([^&]+)/.exec(location.search);a=a&&a[1],"shop"==a&&c(f.find("span")[1])}function c(t){$(t).is("span")&&(f.find("span").removeClass("active"),$(t).addClass("active"),v=$(t).index(),h.attr("placeholder",0==v?h.attr("data-placeholder"):""))}function s(){if(0==v){var t=$.trim($(this).val());if(t){if(w.lastVal==t)return void p.show();w.lastVal=t,w.cache[v]=w.cache[v]||{};var e=w.cache[v];clearTimeout(w.delayId),w.delayId=setTimeout(function(){e[t]?w.render(e[t]):$.ajax({url:w.url,data:{data:'{"keyword":"'+encodeURIComponent(t)+'"}'},dataType:"jsonp"}).then(function(a){e[t]=a,w.render(e[t])})},w.delayTime)}}}function l(t){var e=$(".active",p).removeClass("active");e.length?"up"==t?(e=e.prev(),e.length||(e=p.find(".item").last())):(e=e.next(),e.length||(e=p.find(".item").first())):e=p.find(".item").first(),e.addClass("active"),h.val(e.attr("data-title"))}function r(t){if(t=0==v?$.trim(t)||$.trim(h.attr("data-key")):$.trim(t)){var e=(encodeURIComponent(t),"http://www.meilishuo.com/search/goods/?page=1&searchKey="+encodeURIComponent(t));0!=v&&(e="http://www.meilishuo.com/search/shop/"+encodeURIComponent(t)+"?filter=shop"),location.href=e}}function d(){i(),n(),f.click(function(t){c(t.target)}),g?h.on("input",function(){s.call(this)}):h.on("propertychange",function(){s.call(this)}),h.on("blur",function(){setTimeout(function(){p.hide()},250)}).on("focus",function(){s.call(this)}).on("keyup",function(t){var e=t.keyCode;if(38==e||40==e){var a=38==e?"up":"down";l(a)}else 13==e&&r(this.value)}),p.on("mouseover",function(t){$(".item",this).removeClass("active"),$(t.target).closest(".item").addClass("active")}).on("click",function(t){var e=$(".active",this).attr("data-title"),a=t.target;r("span"==a.tagName.toLowerCase()?e+" "+$(a).text():e)}),m.on("click",function(){r(h.val())})}var h=$(".search-txt"),u=$(".hotword"),f=$(".search-tab"),p=$(".suggest-box"),m=$(".search-btn"),v=0,g="oninput"in document,w={lastVal:null,delayId:null,cache:{},url:"http://search.mogujie.com/jsonp/searchTipsMLS/1",delayTime:500,render:function(t){if(t&&t.success){for(var e=t.data.tips,a="",o=0;o<e.length;o++){for(var n=e[o].props,i="",c=0;c<n.length;c++)i+="<span>"+n[c].title+"</span>";a+='<div class="item" data-title="'+e[o].title+'">'+e[o].title+'<div class="tags">'+i+"</div></div>"}p.html(a).show()}else p.hide()}};d()});;fml.define("common/topbar",[],function(t,a){"use strict";function s(t){var a=$(".cart-goods"),s={marketType:"market_meilishuo",topNum:5};$.ajax({url:"http://cart.meilishuo.com/api/cart/miniCartList",data:s,dataType:"jsonp"}).then(function(s){if("1001"==s.status.code){var e="",o=s.result.cartItems?s.result.cartItems.length:0,r=Math.min(5,o);if(r>0){$(".cart-wrapper .hidden").addClass("down").removeClass("hidden"),t();for(var c=0;c<r;c++){for(var i=s.result.cartItems[c],n="",l=0,d=i.skuAttributes.length;l<d;l++){var p=i.skuAttributes[l];n+="<span>"+p.key+":"+p.value+"</span>&nbsp;&nbsp;"}e+='<li><a href="shopdetail.html#?'+i.itemIdEsc+'" target="_blank" style="padding: 0; float: left;"><span class="cart-goods-img" style="background: url('+i.imgUrl+') no-repeat; background-size: cover;"></span></a><div class="cart-goods-desc"><p><a href="shopdetail.html#?'+i.itemIdEsc+'" target="_blank" style="padding: 0; float: left;"><span class="cart-goods-title">'+i.title+'</span></a><span class="cart-goods-price">￥'+i.nowprice/100+'</span></p><p class="cart-goods-info"><span class="cart-goods-title">'+n+'</span><em class="del-cart-goods" data-stock="'+i.stockIdEsc+'"></em></p></div></li>'}a.html(e)}}})}function e(){$.ajax({url:"http://cart.meilishuo.com/api/cart/getItemCount",data:{marketType:"market_meilishuo"},dataType:"jsonp"}).then(function(t){var a=t.status,s=t.result.count>99?"99+":t.result.count;a.isLogin&&"1001"==a.code&&0!=s&&($(".cart .hidden").addClass(".down").removeClass(".hidden"),$(".my-cart").append('<span class="cart-num">'+s+"</span>"),$(".cart-account .num").text(s))})}function o(){s(e),$("#com-topbar").on("click",".del-cart-goods",function(){var t=$(this).closest("li"),a=$(this).closest(".down"),s=$(this).data("stock");$.ajax({url:"http://cart.meilishuo.com/api/cart/deleteCart",data:{marketType:"market_meilishuo",stockId:s},dataType:"jsonp"}).then(function(s){t.remove();var e=a.find(".cart-goods li").length;e||a.remove()})})}o()});;fml.define("component/mlAlert",[],function(n,t){"use strict";var o={ok:parseInt("0001",2),cancel:parseInt("0010",2),okcancel:parseInt("0011",2)},e={ok:1,cancel:2,close:3},a=function(n,t,a){function i(){f.input===b&&m.append(M),d(),c()}function d(){O.append(A.append(P).append(x)).append(_.append(w).append(m)).append(j.append(r(h))),y.attr("id",B).append(I).append(O),$("body").append(y)}function c(){D.click(s),$(window).bind("keydown",function(n){13==n.keyCode&&1==$("#"+B).length&&s()}),G.click(l),P.click(p)}function s(){var n=($(this),$.trim(M.val()));M.is(":visible")?v.onOk(n):v.onOk(),$("#"+B).remove(),v.onClose(C.ok)}function l(){$(this);v.onCancel(),$("#"+B).remove(),v.onClose(C.cancel)}function p(){$("#"+B).remove(),v.onClose(C.close),$(window).unbind("keydown")}function r(n){var t=$("<div>").addClass("btnGroup");return $.each(T,function(o,e){k[o]==(n&k[o])&&t.append(e)}),t}function u(){var n="pop_"+(new Date).getTime()+parseInt(1e5*Math.random());return $("#"+n).length>0?u():n}var k=o,C=e,f={info:{title:"信息",icon:"",btn:k.ok},success:{title:"成功",icon:"",btn:k.ok},error:{title:"错误",icon:"",btn:k.ok},confirm:{title:"提示",icon:"",btn:k.okcancel},warning:{title:"警告",icon:"",btn:k.okcancel},input:{title:"输入",icon:"",btn:k.ok},custom:{title:"",icon:"",btn:k.ok}},b=t?t instanceof Object?t:f[t]||{}:f.info,v=$.extend(!0,{title:"",icon:"",btn:k.ok,onOk:$.noop,onCancel:$.noop,onClose:$.noop},b,a),m=$("<p>").html(n),x=$("<span>").addClass("tt").text(v.title),g=v.icon,w=g?$("<div>").addClass("bigIcon").css("backgroundPosition",g):"",h=v.btn,B=u(),y=$("<div>").addClass("xcConfirm"),I=$("<div>").addClass("xc_layer"),O=$("<div>").addClass("popBox"),A=$("<div>").addClass("ttBox"),_=$("<div>").addClass("txtBox"),j=$("<div>").addClass("btnArea"),D=$("<a>").addClass("sgBtn").addClass("ok").text("确定"),G=$("<a>").addClass("sgBtn").addClass("cancel").text("取消"),M=$("<input>").addClass("inputBox"),P=$("<a>").addClass("clsBtn"),T={cancel:G,ok:D};i()};return a});;fml.define("common/storelist",["component/mlAlert"],function(o,t){"use strict";var e=o("component/mlAlert"),n=function(){$(".contact-service").on("click",function(){var o=$(this).attr("data-shopid"),t=$(this).attr("data-shopuserid"),e={url:location.href,refer:document.referrer,shopid:o};if(logger.log("000815002",e),Meilishuo&&Meilishuo.config&&Meilishuo.config.userInfo&&Meilishuo.config.userInfo.uid)window._openIm(t);else{var n=location.href||"";location.href="https://account.meilishuo.com/user/login?redirect="+encodeURIComponent(n)}return!1}),$(".pay-attention").on("click",function(o){var t=$(this);i(o,t)}),$(".delete-shop").on("click",function(){function o(){$.ajax({type:"get",url:"http://shopapinew.meilishuo.com/jsonp/collectShop/1?",dataType:"jsonp",data:{shopId:n},success:function(o){o&&!o.success?e(o.data&&o.data.message):$(i).remove()},error:function(o,t){}})}var t=$(this).attr("data-shopid"),n=$(this).attr("data-shopidstr"),i="#shopitem_"+t;e("确定要删除？","confirm",{onOk:o})}),$(document).on("click",function(){$(".dropdown-content").hide()}),$(".triangle").on("click",function(o){$(".dropdown-content").hide(),$(this).parent().find(".dropdown-content").show(),o.stopPropagation()}),$(".dropdown-content").on("click",function(o){o.stopPropagation()}),$(".receive-coupon").on("click",function(){var o=$(this).attr("data-campid"),t=$(this).attr("data-shopid"),n=$(this);$.ajax({type:"get",url:"http://promotionnew.meilishuo.com/jsonp/getShopCoupon/1?",data:{campId:o,shopId:t},dataType:"jsonp",success:function(o){o&&o.success&&$(n).text("已领取"),o&&"SESSION_INVALID"==o.returnCode&&e("用户未登录")},error:function(o,t){}})})},i=function(o,t){var n=t.attr("data-shopidstr"),i=t.attr("data-shopid"),s=t,a="#store_"+i;$.ajax({type:"get",url:"http://shopapinew.meilishuo.com/jsonp/collectShop/1",dataType:"jsonp",data:{shopId:n},success:function(o){if(o&&!o.success)e(o.data&&o.data.message);else if(s.hasClass("attentioned")){$(a).find(".attentioned").removeClass("show"),$(a).find(".notattentioned").addClass("show");var t={url:location.href,refer:document.referrer,type:"N",shopid:i};logger.log("000815003",t)}else if(s.hasClass("notattentioned")){$(a).find(".attentioned").addClass("show"),$(a).find(".notattentioned").removeClass("show");var t={url:location.href,refer:document.referrer,type:"Y",shopid:i};logger.log("000815003",t)}},error:function(o,t){}})};n()});;fml.define("page/search/shop",[],function(n,r){"use strict";function i(n,r,i){var t=n.indexOf("?");if(t>0){if(n.indexOf(i)>0){var e=o(location.search.slice(1)),a="";e[i]=r;for(var f in e){var c;"object"==typeof e[f]?c=JSON.stringify(e[f]):"string"==typeof e[f]&&(c=e[f]),a+=f+"="+c+"&"}return location.pathname+"?"+a.substring(0,a.length-1)}return n+"&"+i+"="+r}return n+"?"+i+"="+r}function o(n){var r=n.split("&"),i={};return $(r).each(function(n,r){var o=r.split("=");i[o[0]]=o[1]}),i}var t=$(".order");$(".mailingInfo");t.on("click",".orderInfo",function(){var n=$(this),r=n.data("order");window.location.href=i(window.location.href,r,"order")})});;fml.define("base",["common/topbar","common/search","common/nav","common/biu","common/ptpParams"],function(m,o){"use strict";m("common/topbar"),m("common/search"),m("common/nav"),m("common/biu"),m("common/ptpParams")});;