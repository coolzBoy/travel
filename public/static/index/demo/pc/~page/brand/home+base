fml.define("common/ptpParams",[],function(i,e){"use strict";window.PTP_PARAMS={EnableLogMoGuJs:!1,uuid:"__mgjuuid",uid:"__ud_",platform:function(){var i=navigator.userAgent;return i.indexOf("meilishuo4android")!=-1||i.indexOf("meilishuo android")!=-1?"24":i.indexOf("meilishuo4ios")!=-1||i.indexOf("Meilishuo iPhone")!=-1?"23":/iphone|android|ipad/i.test(i)?"34":"33"},hrefRe:/http[s]?:\/\/\w+\.(meilishuo|mogujie)\.com([\/]|\/.*|)$/,mgjRe:/(meilishuo|mls):\/\//,isNativeRe:/(meilishuo|mls|mogujie)/i,nativeLog:{}}});;fml.define("common/biu",[],function(o,t){"use strict";var n=function(){function o(){t.css("height",$(document).height()+"px")}var t=$(".biu-sidebar"),n=$(".biu-download"),e=$(".mls-qrcode");o(),$(window).resize(function(){o()}),n.hover(function(){e.css("display","block")},function(){e.css("display","none")}),$(window).scroll(function(){document.body.scrollTop?document.body.scrollTop>0?$(".biu-go2top").css("display","block"):$(".biu-go2top").css("display","none"):document.documentElement.scrollTop&&document.documentElement.scrollTop>0?$(".biu-go2top").css("display","block"):$(".biu-go2top").css("display","none")}),$(".biu-go2top").on("click",function(){window.scrollTo(0,0)}),$.ajax({type:"get",url:"http://cart.meilishuo.com/api/cart/getItemCount?marketType=market_meilishuo",dataType:"jsonp",success:function(o){var t=o||{};1001==t.status.code&&t.result&&t.result.count>0&&(t.result.count>99?$(".biu-cart-num").text("99+"):$(".biu-cart-num").text(t.result.count))},error:function(){console.log("--右侧栏 jsonp请求购物车商品数出错")}}),$.ajax({type:"get",url:"http://promotionnew.meilishuo.com/jsonp/getUnUsedCouponNumber/1?domain=11",dataType:"jsonp",success:function(o){var t=o||{};t.success&&t.data.number>0&&(t.data.number>99?$(".biu-coupon-num").text("99+"):$(".biu-coupon-num").text(t.data.number))},error:function(){console.log("--右侧栏 jsonp请求优惠券数出错")}}),$.ajax({type:"get",url:"http://webim.meilishuo.com/jsonp/cinfo/1",dataType:"jsonp",success:function(o){var t=o||{};t.success&&t.data.number>0&&$(".biu-service-num").text(t.data.number)},error:function(o,t){console.log("--右侧栏 jsonp请求客服消息数出错")}}),$(".biu-open-im").on("click",function(){var o=$(".biu-login").text();return""==o||"0"==o||null==o&&void 0!=o||" "==o?(window.open("https://account.meilishuo.com/user/login"),!1):(window._openIm(o,""),!1)})};n.prototype.biuAddCart=function(o){$.ajax({type:"get",url:"http://cart.meilishuo.com/api/cart/getItemCount?marketType=market_meilishuo",dataType:"jsonp",jsonp:"biuCartNum",success:function(t){var n=t||{};if(1001==n.status.code&&n.result&&n.result.count>0){var e=n.result.count+o;e>0&&e<100?$(".biu-cart-num").text(e):$(".biu-cart-num").text("99+")}}})};var e=new n;t.biuAddCart=e.biuAddCart});;fml.define("common/nav",[],function(t,i){"use strict";var a=$(".sec_attr .list");$(".nav_list");a.hover(function(){var t=$(this).children(".nav_list");0!=t.length&&(a.removeClass("active"),$(this).addClass("active"),t.show())},function(){a.removeClass("active"),$(this).removeClass("active"),$(this).children(".nav_list").hide()});var e=a.length;a.each(function(t){t==e-1&&$(this).addClass("last")});var n=$(".attr_box");"welcome"==Meilishuo.config.controller?n.css("display","block"):$(".all , .attr_box").hover(function(){n.stop(!0,!0).slideDown()},function(t){t.stopPropagation(),n.find(".nav_list").hide(),n.stop(!0,!0).slideUp()});var s={"/welcome":"首页","/brand/street":"品牌街","/officialDirect":"官网直邮","/select":"好物"},o="",l=location.pathname;$.each(s,function(t,i){if(0==l.indexOf(t))return o=s[t],!1}),"/"==l&&(o="首页");var c=$(".nav_tab");c.each(function(){var t=$(this).find("a").html();o==t&&$(this).find("a").addClass("active")})});;fml.define("common/search",[],function(t,e){"use strict";function a(t){t=t.list;for(var e="",a=0;a<t.length;a++){var o=t[a];e+='<a target="_blank" href="http://www.meilishuo.com/search/goods/?page=1&searchKey='+encodeURIComponent(o.word)+'" style="color:'+o.color+'">'+o.word+"</a >"}u.html(e)}function o(t){t&&t.list&&t.list.length&&(t=t.list[0],h.attr({placeholder:t.placehold,"data-placeholder":t.placehold,"data-key":t.word}))}function n(){$.ajax({url:"http://mce.meilishuo.com/jsonp/multiget/3?pids=5604,5571",dataType:"jsonp"}).then(function(t){t.success&&(a(t.data[5571]),o(t.data[5604]))})}function i(t){var e=/(?:&|\?)searchKey=([^&]+)/.exec(location.search);e&&e[1]&&h.val(decodeURI(e[1]));var a=/(?:&|\?)filter=([^&]+)/.exec(location.search);a=a&&a[1],"shop"==a&&c(f.find("span")[1])}function c(t){$(t).is("span")&&(f.find("span").removeClass("active"),$(t).addClass("active"),v=$(t).index(),h.attr("placeholder",0==v?h.attr("data-placeholder"):""))}function s(){if(0==v){var t=$.trim($(this).val());if(t){if(w.lastVal==t)return void p.show();w.lastVal=t,w.cache[v]=w.cache[v]||{};var e=w.cache[v];clearTimeout(w.delayId),w.delayId=setTimeout(function(){e[t]?w.render(e[t]):$.ajax({url:w.url,data:{data:'{"keyword":"'+encodeURIComponent(t)+'"}'},dataType:"jsonp"}).then(function(a){e[t]=a,w.render(e[t])})},w.delayTime)}}}function l(t){var e=$(".active",p).removeClass("active");e.length?"up"==t?(e=e.prev(),e.length||(e=p.find(".item").last())):(e=e.next(),e.length||(e=p.find(".item").first())):e=p.find(".item").first(),e.addClass("active"),h.val(e.attr("data-title"))}function r(t){if(t=0==v?$.trim(t)||$.trim(h.attr("data-key")):$.trim(t)){var e=(encodeURIComponent(t),"http://www.meilishuo.com/search/goods/?page=1&searchKey="+encodeURIComponent(t));0!=v&&(e="http://www.meilishuo.com/search/shop/"+encodeURIComponent(t)+"?filter=shop"),location.href=e}}function d(){i(),n(),f.click(function(t){c(t.target)}),g?h.on("input",function(){s.call(this)}):h.on("propertychange",function(){s.call(this)}),h.on("blur",function(){setTimeout(function(){p.hide()},250)}).on("focus",function(){s.call(this)}).on("keyup",function(t){var e=t.keyCode;if(38==e||40==e){var a=38==e?"up":"down";l(a)}else 13==e&&r(this.value)}),p.on("mouseover",function(t){$(".item",this).removeClass("active"),$(t.target).closest(".item").addClass("active")}).on("click",function(t){var e=$(".active",this).attr("data-title"),a=t.target;r("span"==a.tagName.toLowerCase()?e+" "+$(a).text():e)}),m.on("click",function(){r(h.val())})}var h=$(".search-txt"),u=$(".hotword"),f=$(".search-tab"),p=$(".suggest-box"),m=$(".search-btn"),v=0,g="oninput"in document,w={lastVal:null,delayId:null,cache:{},url:"http://search.mogujie.com/jsonp/searchTipsMLS/1",delayTime:500,render:function(t){if(t&&t.success){for(var e=t.data.tips,a="",o=0;o<e.length;o++){for(var n=e[o].props,i="",c=0;c<n.length;c++)i+="<span>"+n[c].title+"</span>";a+='<div class="item" data-title="'+e[o].title+'">'+e[o].title+'<div class="tags">'+i+"</div></div>"}p.html(a).show()}else p.hide()}};d()});;fml.define("common/topbar",[],function(t,a){"use strict";function s(t){var a=$(".cart-goods"),s={marketType:"market_meilishuo",topNum:5};$.ajax({url:"http://cart.meilishuo.com/api/cart/miniCartList",data:s,dataType:"jsonp"}).then(function(s){if("1001"==s.status.code){var e="",o=s.result.cartItems?s.result.cartItems.length:0,r=Math.min(5,o);if(r>0){$(".cart-wrapper .hidden").addClass("down").removeClass("hidden"),t();for(var c=0;c<r;c++){for(var i=s.result.cartItems[c],n="",l=0,d=i.skuAttributes.length;l<d;l++){var p=i.skuAttributes[l];n+="<span>"+p.key+":"+p.value+"</span>&nbsp;&nbsp;"}e+='<li><a href="shopdetail.html#?'+i.itemIdEsc+'" target="_blank" style="padding: 0; float: left;"><span class="cart-goods-img" style="background: url('+i.imgUrl+') no-repeat; background-size: cover;"></span></a><div class="cart-goods-desc"><p><a href="shopdetail.html#?'+i.itemIdEsc+'" target="_blank" style="padding: 0; float: left;"><span class="cart-goods-title">'+i.title+'</span></a><span class="cart-goods-price">￥'+i.nowprice/100+'</span></p><p class="cart-goods-info"><span class="cart-goods-title">'+n+'</span><em class="del-cart-goods" data-stock="'+i.stockIdEsc+'"></em></p></div></li>'}a.html(e)}}})}function e(){$.ajax({url:"http://cart.meilishuo.com/api/cart/getItemCount",data:{marketType:"market_meilishuo"},dataType:"jsonp"}).then(function(t){var a=t.status,s=t.result.count>99?"99+":t.result.count;a.isLogin&&"1001"==a.code&&0!=s&&($(".cart .hidden").addClass(".down").removeClass(".hidden"),$(".my-cart").append('<span class="cart-num">'+s+"</span>"),$(".cart-account .num").text(s))})}function o(){s(e),$("#com-topbar").on("click",".del-cart-goods",function(){var t=$(this).closest("li"),a=$(this).closest(".down"),s=$(this).data("stock");$.ajax({url:"http://cart.meilishuo.com/api/cart/deleteCart",data:{marketType:"market_meilishuo",stockId:s},dataType:"jsonp"}).then(function(s){t.remove();var e=a.find(".cart-goods li").length;e||a.remove()})})}o()});;fml.define("component/iStorage",[],function(e,t){"use strict";var o=!1,n=!1,i={cookieArr:{},options:{domain:".meilishuo.com",path:"/"},setCookie:function(e,t,o){o=o||{};var n=e+"="+encodeURIComponent(t);if(o.domain||(o.domain=this.options.domain),o.path||(o.path=this.options.path),n+="; domain="+o.domain,o.path&&(n+="; path="+o.path),o.duration){var i=new Date;i.setTime(i.getTime()+1e3*o.duration),n+="; expires="+i.toGMTString()}return o.secure&&(n+="; secure"),document.cookie=n+";"},getCookie:function(e,t){this.cookieArr[e]=this.cookieArr[e]||function(){"string"!=typeof e&&(e=e.toString());var t=window.document.cookie.match("(?:^|;)\\s*"+e.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")+"=([^;]*)");return t?decodeURIComponent(t[1]):void 0}();var o=this.cookieArr[e];return t?t(o):o},removeCookie:function(e){return this.setCookie(e,"",{duration:-1})}},s={set:function(e,t,o,n){o?sessionStorage.setItem(e,t):localStorage.setItem(e,t),"function"==typeof n&&n()},get:function(e,t,o){try{o(t?sessionStorage.getItem(e):localStorage.getItem(e))}catch(e){}},remove:function(e,t){t?sessionStorage.removeItem(e):localStorage.removeItem(e)}},r={flash:document.getElementById("storage"),sessionId:"",callback:[],init:function(e){if(e&&(this.sessionId=this.sessionId||i.getCookie("PHPSESSID")),!o&&!n){n=!0;var t=(new Date,document.createElement("div")),s='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="storage"';s+='codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0" width="1" height="1">',s+='<param name="movie" value="http://i.meilishuo.net/css/images/window/storage1.swf" />',s+='<param name="quality" value="high" />',s+='<param name="allowScriptAccess" value="always" />',s+="</object>",t.innerHTML=s,document.body.appendChild(t),this.flash=document.getElementById("storage")}},detectIE:function(){var e=navigator.userAgent.toLowerCase();if(window.ActiveXObject){var t=e.match(/msie ([\d.]+)/)[1];if(t>=5.5&&t<8)return!0}return!1},set:function(e,t,n,i){function s(e,t,o){if(o){var n=new Date;n=parseInt(n.getTime()/36e5),r.flash.setSessionTime(n),r.flash.setSessionVal(r.sessionId+e,n),r.flash.set(r.sessionId+e,t)}else r.flash.set(e,t)}var r=this;r.init(n),o?(s(e,t,n),"function"==typeof i&&i()):r.callback.push(function(){s(e,t,n),"function"==typeof i&&i()})},get:function(e,t,n){function i(e,t){return t?(s.flash.removeAllSession(),s.flash.get(s.sessionId+e)):s.flash.get(e)}var s=this;s.init(t),o?n(i(e,t)):s.callback.push(function(){n(i(e,t))})},remove:function(e,t){var n=this;if(n.init(t),!o){var n=this;return void window.setTimeout(function(){n.remove(e,t)},100)}t?n.flash.remove(n.sessionId+e):n.flash.remove(e)}},a={set:function(e,t,o,n){o?i.setCookie(e,t):i.setCookie(e,t,{duration:15552e3}),"function"==typeof n&&n()},get:function(e,t,o){o(i.getCookie(e))},remove:function(e,t){i.removeCookie(e)}},c=r.detectIE()?function(){try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return e?r:a}catch(e){return a}}():s;return{isJSReady:function(){return!0},getAllowDomain:function(){var e=e||["www.meilishuo.com","newlab.meilishuo.com","newtest.meilishuo.com","wwwtest.meilishuo.com","cdjdev.meilishuo.com","xhdev.meilishuo.com","rwdev.meilishuo.com","nanodev.meilishuo.com"];return e},flashReadyHandler:function(){o=!0;for(var e=0,t=r.callback.length;e<t;e++)r.callback[e]()},setCookie:function(e,t,o){return i.setCookie(e,t,o)},getCookie:function(e,t){return i.getCookie(e,t)},removeCookie:function(e){return i.removeCookie(e)},setSession:function(e,t,o){return c.set(e,t,!0,o)},getSession:function(e,t){return c.get(e,!0,t)},removeSession:function(e){return c.remove(e,!0)},set:function(e,t,o){return c.set(e,t,!1,o)},get:function(e,t){return c.get(e,!1,t)},remove:function(e){return c.remove(e,!1)}}});;fml.define("component/userstate",["component/iStorage"],function(e,t){"use strict";var n=e("component/iStorage"),r=new Date,o=$.browser,i={};$(document).bind("mousemove",function(){r=new Date}),t.browser=function(e,t){e={ie:"msie"}[e]||e;var n=i[e+t];return void 0!==n?n:n=!!o[e]&&(!t||t==o.version)},t.activity=function(e){return e||(e=30),new Date-r<1e3*e},t.isNew=function(){var e=new Date,t="0"+(e.getMonth()+1),r="0"+e.getDate(),o=e.getFullYear().toString().substr(2)+t.substr(t.length-2)+r.substr(r.length-2),i=n.getCookie("MEILISHUO_GLOBAL_KEY");if(!i)return!1;var s=i.substr(17,6)==o;return s}});;fml.define("component/windowScroll",[],function(n,t){"use strict";function e(n){if(n==window)return 0;var t=n.getAttribute("id")||n.getAttribute("uuid");return t||(t=++a,n.setAttribute("uuid",t)),t}function o(n){return n?n.scrollTop:l.scrollTop||s.scrollTop}function r(n,t){var e=t||window;f.hasOwnProperty(n)||(f[n]=!0,e.onscroll=function(){var e=o(t);c=e-d>0,d=e,u(n),0===n&&i(c)})}function i(n){var t,e,o;n?(t=p,e=v,o="gteFn"):(t=v,e=p,o="ltFn");for(var r=t.length,i=r-1;i>=0;i--){var u=t[i];if(u){var c=u.y;u.dynamicY&&(c=c()),!n^c<=d&&(t.splice(i,1),e.push(u),"function"==typeof u[o]&&u[o](d))}}}function u(n){if(w.hasOwnProperty(n)){var t=w[n];for(var e in t)t[e](d,c)}}var c,f={},a=0,d=0,l=document.documentElement||document.body,s=document.body||document.documentElement,p=[],v=[],w={},y=0;t.property=function(n,t){switch(n){case"height":return t?t.offsetHeight:l.clientHeight;case"scrollTop":return o(t)}},t.unBind=function(n,t){var o=e(t||window),r=w[o];if("string"==typeof n){var i=n;r&&void 0!=r[i]&&delete r[i]}else for(var i in r)if(n==r[i]){delete r[i];break}},t.bind=function(n,t,o){var i=e(o||window);f.hasOwnProperty(i)||r(i,o),w[i]=w[i]||{};var u=w[i];t?u[t]=n:u[y++]=n},t.yIn=function(n,t,e){f.hasOwnProperty(0)||r(0);var i={y:n,gteFn:t,ltFn:e,dynamicY:"function"==typeof n};d=o(),n>d?p.push(i):(v.push(i),t&&t(d))}});;fml.define("core/etic",[],function(e,n){"use strict";function t(e,n,t){if(t&&checkTemplate(e,n),!r[e]){var c=document.getElementById(e).innerHTML;c=c.replace(/[\r\t\n]/g," ").split("<?").join("\t").replace(/((^|\?>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)\?>/g,"',$1,'").split("\t").join("');").split("?>").join(";p.push('").split("\r").join("\\'");try{r[e]=new Function("","var p=[];p.push('"+c+"');return p.join('');")}catch(e){if(console){console.log(e);var o=c.replace(/^[ ]*\'\)|p.push\(\'[ ]*\'\)|p.push\(\'/g,"").replace(/^[ ]*;|;[ ]*$/g,"");console.log(e.message+"   :   "+o);var l=document.createElement("script");l.innerHTML=o;try{new Function("",o)}catch(e){}}}}var p=r[e];if(!n)return p;try{return p.apply(n)}catch(e){console&&(console.log(e),console.log(n))}}var r={};return t});;fml.define("component/lazyLoad",["component/windowScroll","component/userstate"],function(t,e){"use strict";function n(t,e){function n(){r.onload=null;var e=t.getAttribute("title");e&&r.setAttribute("title",e);var n=t.getAttribute("alt");n&&r.setAttribute("alt",n),r.className=t.className,r.style.cssText=t.style.cssText;var o=t.parentNode;o.insertBefore(r,t),t.style.display="none",o.removeChild(t)}var o=t.getAttribute(e);if(o&&"null"!=o&&!(o.indexOf(".")<0)){var r=new Image;t.$$applying||(t.$$applying=!0,f?(c&&(r.src=c),n()):r.onload=n,r.src=o)}}function o(t,e){t.style.backgroundImage="url("+t.getAttribute(e)+")"}function r(t,e,r){for(var i=t.length,s="bg"==r?o:n,l=0;l<i;l++)s(t[l],e)}function i(t,e,n,o,r){for(var i=n.length,s=o;s<=r;s++){if(s>=i)return!0;var l=n.eq(s).offset().top;e.hasOwnProperty(l)||(e[l]=[],t.push(l)),e[l].push(n[s])}return t.sort(function(t,e){return t-e}),!1}function s(e,n,o,s){function l(t,e){if(e){t+=(f?f:p.property("height"))+u;for(var i=d.length,s=-1,c=0;c<i;c++){var m=d[c];m<t&&(g.hasOwnProperty(m)&&r(g[m],n,o),delete g[m],s=c)}s>-1&&d.splice(0,s+1),0==d.length&&(p.unBind(l),a=!1)}}var c,f,p=t("component/windowScroll"),g={},d=[];c=$(e,s),s&&(s=$(s),f=s.height(),u+=s.offset().top,s=$(s)[0]);for(var m,w=c.length,h=0,v=50,y=30,b=!1;h<=w;)m=h+v-1,m>=w&&(m=w-1),window.setTimeout(function(t,e){return function(){b=i(d,g,c,t,e)||b}}(h,m),y),y+=15,h+=v;a||(a=!0,window.setTimeout(function(){l(p.property("scrollTop",s),!0)},y+5),p.bind(l,null,s))}t("component/windowScroll");var l=t("component/userstate"),u=100,a=!1,c="http://img.meilishuo.net/css/images/group/g_loading2.gif",f=l.browser("msie","6.0")||l.browser("msie","7.0");e.setLoading=function(t){c=t},e.load=function(t,e,n,o){window.setTimeout(function(){s(t,e,n,o)},30)}});;fml.define("component/urlHandle",[],function(e,n){"use strict";n.getUrl=function(e){if(""==e)return"";var n={};n=getParams(e);var r=document.createElement("A");r.href=e,n.hostDomain=r.host;var t=n.hostDomain.replace(/\.(com|cn|net|org)/g,"");return t=t.substr(t.lastIndexOf(".")+1),n.rootDomain=n.hostDomain.substr(n.hostDomain.indexOf(t)),n},n.getParams=function(e){if(""==e)return"";for(var n,r,t,o={},i=e.indexOf("?")+1,a=e.indexOf("#")==-1?e.length:e.indexOf("#"),f=e.slice(i,a),u=f.split("&"),t=0,c=u.length;t<c;t++){var s=u[t].indexOf("=");if(s>0){n=u[t].substring(0,s),r=u[t].substr(s+1);try{r.indexOf("+")>-1&&(r=r.replace(/\+/g," ")),o[n]=decodeURIComponent(r)}catch(e){}}}return delete o.frm,o},n.http_build_query=function(e,n,r){var t,o,i=[],a=function(e,n,r){var t,o=[];if(n===!0?n="1":n===!1&&(n="0"),null!=n){if("object"==typeof n){for(t in n)null!=n[t]&&o.push(a(e+"["+t+"]",n[t],r));return o.join(r)}if("function"!=typeof n)return encodeURIComponent(e)+"="+encodeURIComponent(n);throw new Error("There was an error processing for http_build_query().")}return""};r||(r="&");for(o in e){t=e[o],n&&!isNaN(o)&&(o=String(n)+o);var f=a(o,t,r);""!==f&&i.push(f)}return i.join(r)},n.redirect=function(e){var n=/MSIE (\d+\.\d+);/.test(navigator.userAgent);if(e||(location.href=location.href),n){var r=document.createElement("a");r.href=e,document.body.appendChild(r),r.click()}else location.href=e}});;fml.define("component/waterfall",["component/shareTmp"],function(t,e){"use strict";function i(t){return function(e){return e?e.sort(function(e,i){return t(e,i)||e.left-i.left})[0]:null}}function n(t,e){"string"==typeof e&&(e=e.split(v));try{e&&e.length&&e.forEach(function(e){t=t[e]})}catch(t){U("数据结构错误")}finally{return t}}function o(t,e){var i,n,o=e.helpers,a={};if(t&&t.length){for(i in o)o.hasOwnProperty(i)&&(a[i]=o[i]);n=s,n.call(this,t,e,a),e.onLayoutFinished.call(this,e),e.useOptimise&&(e.hasMoved=!0,this.resetCurTop(),p.triggerHandler(e.touchMoveEventName))}}function a(t){return n(t,this._config._dataName)||[]}function r(t){if(p.height()-g-t<S)return!0}function s(t,e,i){var n,o,a,r,s,c,l,f=this.$el,h=e.tmpl,m=e.colWidth,p=e.useOptimise,d=e.colGapT,g=e.data.frame,x=e.isEqualHeight,y=e._boxHeight,v="",T=null,F=this._cols,L=this._colsHistory,w=L[g],b=this._boxes,H=[],N=0;if(w?F=w.map(function(t){return{min:t.min,max:t.min,left:t.left,frame:g}}):w=F.map(function(t){return{min:t.max,max:t.max,left:t.left,frame:g}}),e.rawData[e.drName]&&(i.r=e.rawData[e.drName]),t.forEach(function(t,n){i.v=t,i.index=n,i.totalIndex=e._totalIndex++,v+=u(h,i)}),f.append(n=_.html(v).children()),o=n.length,!v||!o)return U("没有获取到任何新的 DOM 节点, 请检查模板中是否正确处理了数据");if(n.each(function(t,i){var n,a;i.style.width=m+"px",x?(y||(y=e._boxHeight=i.offsetHeight),n=y):n=i.offsetHeight,T=j(F),j(w),a=T.max+"px",H.push({left:T.left,relativeTopStyle:a,top:T.max,width:m,height:n,index:t,el:i,boxLen:o,frame:g,state:p?e.isFirstFrame?E:G:E}),T.max+=n+d}),e.isFirstFrame=!1,L[g]||(L[g]=F.map(function(t,e){return{min:w[e].max,max:t.max,left:w[e].left,frame:g}})),H.forEach(function(t){var e=t.el;e.style.top=t.relativeTopStyle,e.style.left=t.left+"px",t.baseClass=e.className+=" waterfall-frame-"+g+" "+C,e.className+=" "+t.state}),c=H[0].top,e.isBiWaterfall){if(a=b.length){for(;N<a;){if(l=b[N],l.frame>g){s=N;break}N+=l.boxLen}s="undefined"==typeof s?a:s}else s=0;b.splice.apply(b,[s,0].concat(H))}else!b.length||b[b.length-1].top<=c?this._boxes=b.concat(H):this._boxes=H.concat(b);r=P(F).max,(!this._curTop||r>this._curTop)&&this.$el.height(this._curTop=r),this._cols=F.map(function(t,e){var i=this[e];return{min:t.min<i.min?t.min:i.min,max:t.max>i.max?t.max:i.max,left:t.left,frame:g}},this._cols)}function c(t){return t.checkTimes=1,function e(){setTimeout(function(){t.checkTimes++<B&&(t.initTopOffset=t.$el.offset().top,e())},D*t.checkTimes)}}function l(t){var e,i,n,o=t.colGap,a=4;if(o!==o)return console.error(o+" is not a valid number.");if("number"==typeof o)t.colGapT=t.colGapR=t.colGapB=t.colGapL=o;else{if(e=String(o).split(" "),i=e.length,0==i||i>4)return console.error(o+"'s format is not right.");for(;a--;)if(n=e[a],void 0!==n){if(isNaN(n=+n))return console.error(o+" contains invalid number.");e[a]=n}switch(i){case 1:t.colGapT=t.colGapR=t.colGapB=t.colGapL=e[0];break;case 2:t.colGapT=t.colGapB=e[0],t.colGapR=t.colGapL=e[1];break;case 3:t.colGapT=e[0],t.colGapR=t.colGapL=e[1],t.colGapB=e[2];break;case 4:t.colGapT=e[0],t.colGapR=e[1],t.colGapB=e[2],t.colGapL=e[3]}}}function f(t){this._config=t,this._currentAjax=null,this._id=x++,this._boxes=[],this._frames={loaded:{},cur:0,max:0,min:0},this.init()}var u=t("component/shareTmp"),h=document,m=window,p=$(h),d=$(m),g=d.height(),_=$("<div></div>"),x=1,y=!1,v=".",T="down",F="up",L=!1,w=!0,E="waterfall-optimise-show",G="waterfall-optimise-hide",b=function(){return w},H="waterfall-container",C="waterfall-box",N="NORMAL",k="REVERSE",O="$$AddExtraStyle",R={NORMAL:N,REVERSE:k,SHOW:E,HIDE:G,FORCE_CHECK:"waterfall-force-check",EVENT_CLEAR_BACKUP:"waterfall-clear-backup"},S=g/2,A="scroll.waterfall",D=1e3,B=6,I=0,M={el:".goods-wall",tmpl:"posterWall",type:"get",dataType:"json",data:{offset:0,frame:0,trace:0,limit:10},dataName:"tInfo",layoutDirection:N,colGap:8,hasSideGap:!1,isEqualHeight:!1,canFetch:r,dataHandler:o,dataFilter:a,onBeforeFetch:b,onFetchStart:b,onFetchFinished:b,onFetchSuccess:b,onFetchError:b,onLayoutFinished:b,optimise:null,drName:"r"},j=i(function(t,e){return t.max-e.max}),P=i(function(t,e){return e.max-t.max}),W=i(function(t,e){return e.min-t.min}),V=[],q=0,K=0,U=function(){return m.console?function(t){console.log(t)}:b}();!function(){if(!m[O]){m[O]=!0;var t=h.createElement("style");t.id="waterfall-optimise-style",t.innerHTML="."+E+"{display:block;}."+G+"{display:none;}."+H+"{position:relative;}."+C+"{position:absolute;}",t.appendChild(h.createTextNode("")),h.head.appendChild(t)}}(),f.prototype={constructor:f,init:function(){var t,e,i,n,o,a,r=this._config,s=r.colNum,f=r.hasSideGap,u=0,h=0,m=0;if(n=this.$el=r.$el=$(r.el),!n.length)throw Error("el 参数指定的 DOM 元素不存在!");if(n.addClass(H),this._cols=o=[],this._colsHistory=[],r.initTopOffset=n.offset().top,r.isFirstFrame=!0,c(r)(),l(r),t=r.colGapL,e=r.colGapR,i=e,f&&(h=2*t),!s||s<=0)throw Error("请传入 colNum");for(a=r.colWidth=Math.floor((n.width()-h-(s-1)*i)/s);u<s;u++)0==u?m=f?t:0:m+=a+i,o.push({min:0,max:0,left:m,frame:0});(r.useOptimise=!!r.optimiseFn)&&r.optimiseFn.initRange(s)},fetch:function(t){function e(t,e){a.onFetchFinished.call(o,t,e),o._isLoading=!1}function i(t){var e=o._frames,i=r.frame;a.rawData=t,t=a.dataFilter.call(o,t),a.onFetchSuccess.call(o,t,a),a.dataHandler.call(o,t,a),e.loaded[r.frame]=1,e.max<i&&(e.max=i),e.min>i&&(e.min=i),a.layoutDirection==N?r.frame++:r.frame--,r.trace=t.trace||0}function n(t,e,i){o._isLoading=!1,a.onFetchError.call(o,i,e)}var o=this,a=o._config,r=a.data;if(!o._isLoading)return o._isLoading=!0,a.onBeforeFetch.call(o,a)===L?void(o._isLoading=!1):(o._config.onFetchStart.call(o,a),this.isFrameLoaded(a.data.frame)?void(o._isLoading=!1):t?void setTimeout(function(){e(null,200),i(t)},0):void(this._currentAjax=$.ajax({type:a.type,dataType:a.dataType,data:r,url:a.url,success:i,error:n,complete:e})))},start:function(t){return this.fetch(t),this},lock:function(){return this._isLock=!0,this},isLoading:function(){return this._isLoading},getColsInfo:function(){return $.extend(!0,[],this._cols)},getColsHistoryInfo:function(){return $.extend(!0,[],this._colsHistory)},setColsHistoryInfo:function(t){return this._colsHistory=$.extend(!0,[],t),this},setColsInfo:function(t){return t&&t.length&&(this._cols=$.extend(!0,[],t)),this},getParam:function(t){return this._config[t]},updateParam:function(t,e){return this._config[t]=e,this},getDataByPath:n,updateLayoutDirection:function(t){if(!(t in R))throw Error(t+" is not a valid direction.");return this._config.layoutDirection=t,this},findLowestCol:function(){return W(this._cols)},findHighestCol:function(){return P(this._cols)},isFrameLoaded:function(t){return!!this._frames.loaded[t]},getCurrentFrame:function(){return this._config.data.frame},unlock:function(){return this._isLock=!1,this},destroy:function(){for(var t=q;t--;)V[t]._id===this._id&&(this._currentAjax&&(this._currentAjax.abort(),this._currentAjax=null),V.splice(t,1),q--)},resetCurTop:function(){return this._boxes._curTop=-9999,this},triggerScroll:function(t){return d.triggerHandler(A,[t||T]),this}},d.on(A,function(t,e){var i,n,o;q&&(n=d.scrollTop(),n||y?y=!1:(y=!0,clearTimeout(I),I=setTimeout(function(){o=!0,d.trigger(A)},10)),i=e==T||e!=F&&n>=K,K=n,V.forEach(function(t){t._isLock||t._config.canFetch.call(t,n,i)===w&&(t.fetch(),o&&t.resetCurTop())}))}),e.CONS=R,e.init=function(t){var e,i,n,o,a;if(t=$.extend(!0,{_totalIndex:0},M,t),"string"==typeof t.dataName&&(t._dataName=t.dataName.split(".")),i=t.plugins){if(Array.isArray(i)&&(o=i.some(function(t,e){return t.takeOver&&(a=e,1)})))return n=t.plugins.splice(a,1)[0],n.init(t);if(i.takeOver)return delete t.plugins,i.init(t)}return V.push(e=new f(t)),q++,i&&i.forEach(function(t){t.init(e)}),e}});;fml.define("component/shareTmp",["core/etic"],function(e,t){"use strict";var c=e("core/etic");return function(e,t){t=t||Object;try{var r=c(e,t)}catch(e){fml.debug(e)}return r}});;fml.define("page/brand/home",["component/shareTmp","component/waterfall","component/urlHandle","component/lazyLoad"],function(require,exports){"use strict";var shareTmp=require("component/shareTmp"),waterfall=require("component/waterfall"),urlHandle=require("component/urlHandle"),lazyLoad=require("component/lazyLoad"),brandHome={query:"",filterType:"",noMoreClass:"",saleNumClass:"",$filterTab:null,fixedFlag:!1,waterFallInstance:null,init:function(e){this.query=urlHandle.getParams(window.location.href.toString()),this.noMore=e.noMoreClass,this.saleNum=e.saleNumClass,this.$filterTab=e.filterTab,this.filterType=this.query.sort||"new",this.bindEvent()},bindEvent:function(){var e=0;this.query.page>1&&(e=document.querySelector(".filter_wrap").getBoundingClientRect().top,$("body").animate({scrollTop:e+"px"},400)),setTimeout(function(){lazyLoad.load(".img_url > span","asrc","bg",".goods-wall")},1e3),this.bindScrollTabFixed(),this.bindTabEvent()},toggleClass:function(e,a,r){this.fixedFlag=!0,e.className=e.className.replace(a,r),this.fixedFlag=!1},bindScrollTabFixed:function(){var e=this;$(window).scroll(function(a){var r=document.querySelector(".filter_wrap"),l=document.querySelector(".brand_products_wrap"),t=l.getBoundingClientRect(),n="no_fixed",i="fixed",o=r.className;this.fixedFlag||(o.indexOf(n)!=-1&&t.top<=42?e.toggleClass(r,n,i):o.indexOf(" "+i)!=-1&&t.top>42&&e.toggleClass(r,i,n))})},bindTabEvent:function(){var e=this;$(".brand_tag_filter").on("click","li",function(){var a,r=0;switch(r=$(".brand_tag_filter li").index($(this))){case 0:e.filterType="new";break;case 1:e.filterType="pop"}a=window.location.search,e.query.sort?a=e.replaceParamVal(a,"sort",e.filterType):(a=a.split("&"),a.push("sort="+e.filterType),a=a.join("&")),a=e.replaceParamVal(a,"page",1),urlHandle.redirect(a)})},replaceParamVal:function(oldUrl,paramName,replaceWith){var re=eval("/("+paramName+"=)([^&]*)/gi"),nUrl=oldUrl.replace(re,paramName+"="+replaceWith);return nUrl}},config={noMoreClass:".noMore",saleNumClass:".saleNumber",filterTab:".brand_tag_filter"};brandHome.init(config)});;fml.define("base",["common/topbar","common/search","common/nav","common/biu","common/ptpParams"],function(m,o){"use strict";m("common/topbar"),m("common/search"),m("common/nav"),m("common/biu"),m("common/ptpParams")});;